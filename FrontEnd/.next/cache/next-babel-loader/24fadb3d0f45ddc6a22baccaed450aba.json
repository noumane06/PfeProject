{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\n// Dependencies ------------------------\nimport { useState, useEffect } from 'react';\nimport { Menu, Button, message } from 'antd';\nimport axios from 'axios';\nimport '../../../styles/ant-picker.scss';\nimport { storage } from '../../../components/firebase'; // Components -------------------------\n\nimport Head from '../../../components/head';\nimport Icon from '@ant-design/icons';\nimport HomeSvg from './Svg/HomeSvg';\nimport AboutSvg from './Svg/AboutSvg';\nimport CalendarSvg from './Svg/CalendarSvg';\nimport '../Sass/fullProfile.scss';\nimport LikeButton from '../../../components/LikeButton';\nimport Geocode from \"react-geocode\";\nimport Modal from 'antd/lib/modal/Modal';\nimport EditBox from './Components/EditBox';\nimport Calendar from './Components/BookMeeting';\nimport NavAcceuil from './Components/NavAcceuil';\nimport NavPropos from './Components/NavPropos';\nimport ProgressBar from './Components/ProgressBar';\nimport ProfileHead from './Components/ProfileHead'; // -------------------------------------\n\nfunction isEmpty(obj, type) {\n  if (type === \"Société\") {\n    for (const [key, value] of Object.entries(obj)) {\n      if (value == \"\" || value == []) {\n        if (key !== \"booked\") {}\n      }\n    }\n  }\n\n  if (obj[\"addresse\"] === \"\") {\n    return true;\n  }\n\n  return false;\n} // ----------------------------\n\n\nconst ProfileBody = ({\n  profile,\n  userid\n}) => {\n  // States ---------------------------------------\n  const name = profile.companyname === \"\" || profile.companyname == undefined ? profile.nom + \" \" + profile.prenom : profile.companyname;\n  const {\n    0: imageLoading,\n    1: setloadimage\n  } = useState(false);\n  const {\n    0: current,\n    1: setCurrent\n  } = useState('Acceuil');\n  const {\n    0: checkbox,\n    1: setCheck\n  } = useState(profile.stars.includes(userid));\n  const {\n    0: bookmetting,\n    1: setbook\n  } = useState(false);\n  const {\n    0: data,\n    1: setData\n  } = useState(profile);\n  const {\n    0: location,\n    1: setLocation\n  } = useState({});\n  const {\n    0: filefirebase,\n    1: setfire\n  } = useState(null);\n  const {\n    0: percentage,\n    1: setPrecentage\n  } = useState(0);\n  const {\n    0: visible,\n    1: setvisible\n  } = useState(false);\n  const {\n    0: loading,\n    1: setloading\n  } = useState(false);\n  const {\n    0: DiplomeList,\n    1: setDiplomeList\n  } = useState(profile.diplome);\n  const date = new Date(); // Icons -----------------------------------------\n\n  const HomeIcon = props => __jsx(Icon, _extends({\n    component: HomeSvg\n  }, props));\n\n  const AboutIcon = props => __jsx(Icon, _extends({\n    component: AboutSvg\n  }, props));\n\n  const CalendarIcon = props => __jsx(Icon, _extends({\n    component: CalendarSvg\n  }, props));\n\n  useEffect(() => {\n    const adr = profile.addresse + \" , \" + profile.city;\n    Geocode.setApiKey(\"AIzaSyChI3vJkg_P6JFZKVg9at3FtUZjxxI2lP8\");\n    Geocode.fromAddress(adr).then(response => {\n      const {\n        lat,\n        lng\n      } = response.results[0].geometry.location;\n      const loc = {\n        address: profile.addresse,\n        lat: lat,\n        lng: lng\n      };\n      setLocation(loc);\n    }, error => {\n      console.error(error);\n    });\n  }, []); // Firebase url upload function \n\n  const firebaseUrl = file => {\n    return new Promise((resolve, reject) => {\n      let currentImageName = \"firebase-image-\" + Date.now();\n      let uploadImage = storage.ref(`images/${currentImageName}`).put(file);\n      uploadImage.on('state_changed', snapshot => {\n        var per = Math.floor(snapshot.bytesTransferred / snapshot.totalBytes * 100);\n        setPrecentage(per);\n      }, error => {\n        reject(error);\n      }, () => {\n        storage.ref('images').child(currentImageName).getDownloadURL().then(url => {\n          const imageData = [url, currentImageName];\n          resolve(imageData);\n        });\n      });\n    });\n  }; // Handlers -------------------------------------\n\n\n  const handleLike = async () => {\n    var stars = profile.stars;\n\n    if (!checkbox) {\n      await stars.push(userid);\n    } else {\n      await stars.splice(stars.indexOf(userid), 1);\n    }\n\n    setCheck(!checkbox);\n    const Url = 'http://15.237.56.214:9000/profiles/like?userid=' + profile._id;\n    axios.post(Url, {\n      \"stars\": stars\n    }, {\n      withCredentials: true\n    }).then(res => console.log(res)).catch(err => console.log(err));\n  };\n\n  const handleClick = e => {\n    setCurrent(e.key);\n  };\n\n  const handleBack = () => {\n    window.location.assign(`/Search?companyname=${profile.companyname}&domaine=&city=&page=1`);\n  };\n\n  const handleEdit = () => {\n    setvisible(true);\n  };\n\n  const handleSave = async () => {\n    let OldData = data;\n    OldData[\"diplome\"] = DiplomeList;\n    setData(OldData);\n\n    if (isEmpty(data, profile.type)) {\n      message.error(\"Un ou plusieurs champs sont vides\");\n    } else {\n      setloading(true);\n\n      if (filefirebase !== null) {\n        setloadimage(true);\n        const imgData = await firebaseUrl(filefirebase);\n        setData(data.Usrimg = imgData[0]);\n      }\n\n      const url = \"http://15.237.56.214:9000/profiles/update?userid=\" + userid;\n      axios.post(url, data, {\n        withCredentials: true\n      }).then(response => {\n        if (response.status === 200) {\n          setloading(false);\n          setvisible(false);\n          message.success(\"Mise à jour réussie\");\n          setTimeout(() => {\n            window.location.reload();\n          }, 1000);\n        } else {\n          message.error(\"Une erreur s'est produite, veuillez réessayer plus tard\");\n        }\n      }).catch(err => {\n        message.error(\"Une erreur s'est produite, veuillez réessayer plus tard\");\n        console.log(err);\n      });\n    }\n  }; // ----------------------- Returner ----------------------------------------\n\n\n  return __jsx(\"div\", {\n    className: \"Profile\"\n  }, __jsx(Head, {\n    title: name + \" | 6Solutions\"\n  }), __jsx(\"div\", {\n    className: \"ButtonContainer\",\n    onClick: handleBack\n  }, __jsx(\"i\", {\n    className: \"fa fa-arrow-left icon\"\n  }), __jsx(\"span\", {\n    className: \"backButton\"\n  }, \"Retour\")), __jsx(ProfileHead, {\n    profile: profile,\n    handleEdit: handleEdit,\n    setbook: setbook,\n    userid: userid\n  }), __jsx(\"div\", {\n    className: \"ProfileBody\"\n  }, __jsx(Modal, {\n    style: {\n      top: '9%'\n    },\n    title: \"Selectionnez la cellule correspondante a votre r\\xE9union\",\n    visible: bookmetting,\n    width: \"90%\",\n    bodyStyle: {\n      height: '70vh',\n      overflowY: 'scroll'\n    },\n    onCancel: () => setbook(false),\n    footer: null\n  }, __jsx(Calendar, {\n    profile: profile,\n    loc: \"public\"\n  })), __jsx(Modal, {\n    title: \"Editez votre profile\",\n    className: \"EditModal\",\n    visible: visible,\n    bodyStyle: {\n      height: '50vh',\n      overflowY: 'scroll'\n    },\n    onCancel: () => setvisible(false),\n    footer: [__jsx(Button, {\n      disabled: false,\n      key: \"submit\",\n      type: \"primary\",\n      loading: loading,\n      style: {\n        borderRadius: '10px',\n        fontFamily: 'GlacialBold'\n      },\n      onClick: handleSave\n    }, \"Termin\\xE9 !\")]\n  }, !imageLoading && __jsx(EditBox, {\n    data: data,\n    setData: setData,\n    setDiplomeList: setDiplomeList,\n    DiplomeList: DiplomeList,\n    setfire: setfire\n  }), imageLoading && __jsx(ProgressBar, {\n    percentage: percentage\n  })), __jsx(Menu, {\n    onClick: handleClick,\n    selectedKeys: current,\n    mode: \"horizontal\",\n    style: {\n      marginTop: '3%'\n    }\n  }, __jsx(Menu.Item, {\n    key: \"Acceuil\",\n    icon: __jsx(HomeIcon, null)\n  }, \"Acceuil\"), __jsx(Menu.Item, {\n    key: \"propos\",\n    icon: __jsx(AboutIcon, null)\n  }, \"A propos\"), userid === profile._id && profile.type === \"Société\" && __jsx(Menu.Item, {\n    key: \"Calendar\",\n    icon: __jsx(CalendarIcon, null)\n  }, \"Calendrier\")), __jsx(\"div\", {\n    className: \"MenuContent\"\n  }, current === \"Acceuil\" && __jsx(React.Fragment, null, __jsx(NavAcceuil, {\n    date: date,\n    profile: profile\n  })), current === \"propos\" && __jsx(React.Fragment, null, __jsx(NavPropos, {\n    profile: profile,\n    location: location\n  })), current === \"Calendar\" && __jsx(\"div\", {\n    style: {\n      marginTop: '30px'\n    }\n  }, __jsx(Calendar, {\n    profile: profile,\n    loc: \"profile\"\n  }))), __jsx(\"div\", {\n    className: \"MenuFooter\"\n  }, userid !== profile._id && profile.type === \"Société\" && __jsx(\"div\", {\n    className: \"like\"\n  }, __jsx(LikeButton, {\n    checkbox: checkbox,\n    handleLike: handleLike\n  }), __jsx(\"label\", {\n    htmlFor: \"checkbox\",\n    className: checkbox ? \"active\" : \"\"\n  }, \"J'aime\")), __jsx(\"div\", {\n    className: \"share\"\n  }, __jsx(\"i\", {\n    className: \"fa fa-share-alt\",\n    \"aria-hidden\": \"true\",\n    style: {\n      marginRight: '5px'\n    }\n  }), \"Partager\"))));\n};\n\nexport default ProfileBody;","map":null,"metadata":{},"sourceType":"module"}