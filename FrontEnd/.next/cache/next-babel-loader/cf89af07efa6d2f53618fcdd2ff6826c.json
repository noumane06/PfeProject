{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n// Dependencies -------------------\nimport axios from 'axios';\nimport Lottie from 'react-lottie';\nimport { useState, useEffect } from 'react';\nimport { Progress, Spin, Select, Modal } from 'antd'; // File import ---------------------------------\n\nimport animationData from './Components/Anim.json';\nimport errorData from './Components/Error.json';\nimport loadingData from './Components/Loading.json';\nimport successData from './Components/Success.json';\nimport Head from '../../components/head';\nimport { storage } from './Components/firebase-config';\nimport '../../styles/ProfileSettings.scss';\nimport Footer from '../../components/footer'; //---------------------------------\n\nvar Settings = function Settings(props) {\n  var Option = Select.Option; // States \n\n  var _useState = useState(),\n      data = _useState[0],\n      setData = _useState[1];\n\n  var _useState2 = useState(),\n      DiplomeList = _useState2[0],\n      setDiplomeList = _useState2[1];\n\n  var _useState3 = useState(0),\n      percentage = _useState3[0],\n      setPrecentage = _useState3[1];\n\n  var _useState4 = useState(),\n      usrid = _useState4[0],\n      setId = _useState4[1];\n\n  var _useState5 = useState(null),\n      DataState = _useState5[0],\n      setState = _useState5[1];\n\n  var _useState6 = useState(),\n      file = _useState6[0],\n      setFile = _useState6[1];\n\n  var _useState7 = useState(true),\n      loading = _useState7[0],\n      setLoading = _useState7[1];\n\n  var _useState8 = useState(false),\n      sendingData = _useState8[0],\n      setSend = _useState8[1];\n\n  var _useState9 = useState(null),\n      filefirebase = _useState9[0],\n      setfire = _useState9[1];\n\n  var _useState10 = useState(false),\n      visible = _useState10[0],\n      setvisible = _useState10[1];\n\n  var _useState11 = useState(false),\n      changed = _useState11[0],\n      setchanged = _useState11[1];\n\n  var _useState12 = useState(\"/\"),\n      location = _useState12[0],\n      setLocation = _useState12[1];\n\n  var Fields = [\"Arabe\", \"Francais\", \"Anglais\", \"Spanish\"];\n  var children = [];\n  Fields.map(function (Field) {\n    children.push(__jsx(Option, {\n      key: Field\n    }, Field));\n  }); // ----------------------------------------------\n  // Modal functions \n\n  var showModal = function showModal() {\n    setvisible(true);\n  };\n\n  var handleCancel = function handleCancel() {\n    setvisible(false);\n  }; // Firebase url upload function \n\n\n  var firebaseUrl = function firebaseUrl(file) {\n    return new Promise(function (resolve, reject) {\n      var currentImageName = \"firebase-image-\" + Date.now();\n      var uploadImage = storage.ref(\"images/\".concat(currentImageName)).put(file);\n      uploadImage.on('state_changed', function (snapshot) {\n        var per = Math.floor(snapshot.bytesTransferred / snapshot.totalBytes * 100);\n        setPrecentage(per);\n      }, function (error) {\n        reject(error);\n      }, function () {\n        storage.ref('images').child(currentImageName).getDownloadURL().then(function (url) {\n          var imageData = [url, currentImageName];\n          resolve(imageData);\n        });\n      });\n    });\n  }; // Hook getting called before the render \n\n\n  useEffect(function () {\n    if (props.statusCode === 401) {\n      var _location = \"/Auth/Signin/?ref=tokenexpired&location=\" + window.location.href;\n\n      window.location.replace(_location);\n    } else {\n      setId(props.data.profile._id);\n      setDiplomeList(props.data.profile.diplome);\n      setFile(props.data.profile.Usrimg);\n      setData(props.data.profile);\n      setLoading(false);\n    }\n  }, []); // On submit ----------------------------------\n\n  var Onsubmit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var OldData, imgData, url;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setSend(true);\n              OldData = data;\n              OldData[\"diplome\"] = DiplomeList;\n              setData(OldData);\n\n              if (!(filefirebase !== null)) {\n                _context.next = 11;\n                break;\n              }\n\n              _context.next = 7;\n              return firebaseUrl(filefirebase);\n\n            case 7:\n              imgData = _context.sent;\n              setData(data.Usrimg = imgData[0]);\n              _context.next = 12;\n              break;\n\n            case 11:\n              setState(\"Loading\");\n\n            case 12:\n              ;\n              console.log(data);\n              url = \"http://localhost:9000/profiles/update?userid=\" + usrid;\n              _context.next = 17;\n              return axios.post(url, data, {\n                withCredentials: true\n              }).then(function (response) {\n                if (response.status === 200) {\n                  setState(\"done\");\n                  setTimeout(function () {\n                    window.location.assign(location);\n                  }, 2000);\n                } else {\n                  setState(\"error\");\n                }\n              })[\"catch\"](function (err) {\n                setState(\"error\");\n                console.log(err);\n              });\n\n            case 17:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function Onsubmit() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleInputChnage = function handleInputChnage(event) {\n    var name = event.target.name;\n    var value = event.target.value;\n    setData(_objectSpread(_objectSpread({}, data), {}, _defineProperty({}, name, value)));\n  }; // ------------------------------------------------\n  // When click on delete picture \n\n\n  var handleClick = function handleClick() {\n    URL.revokeObjectURL(file);\n    setFile(data.Usrimg);\n    setchanged(false);\n  }; // When change of image\n\n\n  var handleChange = function handleChange(e) {\n    setchanged(true);\n\n    if (e.target.files[0] !== undefined) {\n      try {\n        setfire(e.target.files[0]);\n        var url = URL.createObjectURL(e.target.files[0]);\n        setFile(url);\n      } catch (error) {\n        console.error(error);\n        alert(error);\n      }\n    }\n  };\n\n  var dipChange = function dipChange(e, index) {\n    var _e$target = e.target,\n        name = _e$target.name,\n        value = _e$target.value;\n\n    var list = _toConsumableArray(DiplomeList);\n\n    list[index][name] = value;\n    setDiplomeList(list);\n  };\n\n  var handleAddClick = function handleAddClick() {\n    setDiplomeList([].concat(_toConsumableArray(DiplomeList), [{\n      diplomeName: \"\",\n      desc: \"\"\n    }]));\n  }; // handle click event of the Remove button\n\n\n  var handleRemoveClick = function handleRemoveClick(index) {\n    var list = _toConsumableArray(DiplomeList);\n\n    list.splice(index, 1);\n    setDiplomeList(list);\n  }; // -----------------------------\n  // Languages handler \n\n\n  var handleLang = function handleLang(value) {\n    var string = value;\n    setData(_objectSpread(_objectSpread({}, data), {}, {\n      languages: string\n    }));\n  }; // Lottie options \n\n\n  var defaultOptions = {\n    loop: true,\n    autoplay: true,\n    animationData: animationData,\n    rendererSettings: {\n      preserveAspectRatio: \"xMidYMid\"\n    }\n  };\n  var LoadingOptions = {\n    loop: true,\n    autoplay: true,\n    animationData: loadingData,\n    rendererSettings: {\n      preserveAspectRatio: \"xMidYMid\"\n    }\n  };\n  var ErrorOptions = {\n    loop: false,\n    autoplay: true,\n    animationData: errorData,\n    rendererSettings: {\n      preserveAspectRatio: \"xMidYMid\"\n    }\n  };\n  var DoneOptions = {\n    loop: false,\n    autoplay: true,\n    animationData: successData,\n    rendererSettings: {\n      preserveAspectRatio: \"xMidYMid\"\n    }\n  }; // ---------------------------------\n\n  if (loading) {\n    return __jsx(React.Fragment, null, __jsx(Head, {\n      title: \"Configurez votre profile | 6 Solutions\"\n    }), __jsx(\"div\", {\n      className: \"spincentered\"\n    }, __jsx(Spin, {\n      size: \"large\"\n    })));\n  } else {\n    return __jsx(React.Fragment, null, __jsx(\"div\", {\n      className: \"ConfigureProfile\"\n    }, __jsx(Head, {\n      title: \"Configurez votre profile | 6 Solutions\"\n    }), __jsx(\"div\", {\n      className: \"ContentInside\"\n    }, __jsx(\"div\", {\n      className: \"HeaderContainer\",\n      onClick: function onClick() {\n        return window.location.assign(\"/\");\n      },\n      style: {\n        cursor: 'pointer'\n      }\n    }, __jsx(\"div\", {\n      className: \"Header_Logo\"\n    }, __jsx(\"img\", {\n      src: \"../static/Icons/LOGO2017.png\",\n      height: \"30\"\n    })), __jsx(\"div\", null), __jsx(\"span\", null, \"Help\")), sendingData && DataState === null && __jsx(\"div\", {\n      className: \"SendingData\"\n    }, __jsx(Progress, {\n      type: \"circle\",\n      strokeColor: {\n        '0%': '#00308F',\n        '100%': '#7CB9E8'\n      },\n      percent: percentage\n    }), __jsx(\"h1\", null, \"Veuillez patienter ... \"), __jsx(\"p\", null, \"Nous mettons \\xE0 jour votre profil\")), sendingData && DataState === \"Loading\" && __jsx(\"div\", {\n      className: \"SendingData\"\n    }, __jsx(Lottie, {\n      options: LoadingOptions,\n      height: 200,\n      width: 200\n    }), __jsx(\"h1\", null, \"Veuillez patienter ... \"), __jsx(\"p\", null, \"Nous mettons \\xE0 jour votre profil\")), sendingData && DataState == \"error\" && __jsx(\"div\", {\n      className: \"WrongData\"\n    }, __jsx(Lottie, {\n      options: ErrorOptions,\n      height: 200,\n      width: 200\n    }), __jsx(\"h1\", null, \"Veuillez r\\xE9essayer plus tard\"), __jsx(\"p\", null, \"Une erreur s'est produite lors de la mise \\xE0 jour\")), sendingData && DataState == \"done\" && __jsx(\"div\", {\n      className: \"SuccessData\"\n    }, __jsx(Lottie, {\n      options: DoneOptions,\n      height: 200,\n      width: 200\n    }), __jsx(\"h1\", null, \"Mise \\xE0 jour du profil r\\xE9ussie\"), __jsx(\"p\", null, \"Vous serez bient\\xF4t redirig\\xE9\")), !sendingData && __jsx(React.Fragment, null, __jsx(\"div\", {\n      className: \"FlexContainer\"\n    }, __jsx(\"div\", {\n      className: \"dataContainer\"\n    }, __jsx(\"div\", {\n      className: \"formConfig\"\n    }, __jsx(\"div\", {\n      className: \"form_Head\"\n    }, __jsx(\"div\", {\n      className: \"ProfileImg\"\n    }, __jsx(\"img\", {\n      src: file,\n      onClick: showModal\n    }), __jsx(\"br\", null), __jsx(\"div\", null, __jsx(\"label\", {\n      className: \"custom-file-upload\"\n    }, __jsx(\"input\", {\n      type: \"file\",\n      id: \"img\",\n      name: \"img\",\n      placeholder: \"Choisissez photo\",\n      accept: \"image/*\",\n      onChange: handleChange\n    }), __jsx(\"i\", {\n      className: \"fa fa-upload\",\n      \"aria-hidden\": \"true\"\n    }), \"   Ajouter photo\"), changed && __jsx(\"label\", {\n      className: \"Showmodal\",\n      onClick: handleClick\n    }, __jsx(\"i\", {\n      \"class\": \"fa fa-user-times\",\n      style: {\n        color: '#be0000'\n      }\n    }))), __jsx(Modal, {\n      title: \"Image de profile\",\n      visible: visible,\n      onCancel: handleCancel,\n      footer: null\n    }, __jsx(\"img\", {\n      src: file,\n      width: \"100%\"\n    }))), __jsx(\"div\", {\n      className: \"ProfileInfo\"\n    }, data.type == \"Société\" && __jsx(\"h3\", null, data.companyname), data.type == \"Client\" && __jsx(\"h3\", null, data.nom, \" \", data.prenom))), __jsx(\"div\", {\n      className: \"fieldsContainer\"\n    }, __jsx(\"div\", {\n      className: \"Row\"\n    }, __jsx(\"label\", null, \"Presentation\"), __jsx(\"br\", null), __jsx(\"textarea\", {\n      className: \"input\",\n      name: \"presentation\",\n      placeholder: data.type !== \"Société\" ? \"Parlez-nous de vous (optionnel)\" : \"Décrivez votre entreprise\",\n      rows: \"4\",\n      onChange: handleInputChnage,\n      value: data.presentation\n    }), __jsx(\"label\", null, \"Langues parl\\xE9s\"), __jsx(Select, {\n      mode: \"tags\",\n      style: {\n        width: '100%',\n        marginTop: '20px',\n        padding: '7px 4px',\n        borderRadius: '10px',\n        backgroundColor: '#e9f1fa'\n      },\n      placeholder: \"Ex: Francais , arabe ...\",\n      onChange: handleLang,\n      value: data.languages,\n      maxTagCount: 3\n    }, children), __jsx(\"label\", null, \"Dipl\\xF4me et formations\"), __jsx(\"div\", {\n      className: \"Diplomes\"\n    }, DiplomeList.map(function (element, index) {\n      return __jsx(\"div\", {\n        className: \"container\"\n      }, __jsx(\"input\", {\n        className: \"input diplome\",\n        type: \"text\",\n        name: \"diplomeName\",\n        placeholder: \"Votre Diplome\",\n        value: element.diplomeName,\n        onChange: function onChange(e) {\n          return dipChange(e, index);\n        }\n      }), __jsx(\"input\", {\n        className: index !== 0 ? \"input desc2\" : \"input desc\",\n        type: \"text\",\n        name: \"desc\",\n        placeholder: \"Br\\xE8ve description\",\n        value: element.desc,\n        onChange: function onChange(e) {\n          return dipChange(e, index);\n        }\n      }), index !== 0 && __jsx(\"label\", {\n        className: \"delete\",\n        onClick: function onClick() {\n          return handleRemoveClick(index);\n        }\n      }, __jsx(\"i\", {\n        \"class\": \"fa fa-trash\",\n        \"aria-hidden\": \"true\",\n        style: {\n          color: '#be0000'\n        }\n      })));\n    }), __jsx(\"div\", {\n      className: \"container \"\n    }, __jsx(\"button\", {\n      onClick: handleAddClick,\n      className: \"ajouter\"\n    }, \"Ajouter\")))))), __jsx(\"div\", {\n      className: \"Illustration\"\n    }, __jsx(\"div\", {\n      className: \"ill\"\n    }, __jsx(Lottie, {\n      options: defaultOptions,\n      height: 500,\n      width: 500\n    })), __jsx(\"div\", {\n      className: \"buttonContainer\"\n    }, __jsx(\"a\", {\n      className: \"later\",\n      href: \"/\",\n      style: {\n        textDecoration: 'none'\n      }\n    }, \"later\"), __jsx(\"input\", {\n      className: \"SignButton next\",\n      type: \"submit\",\n      onClick: Onsubmit,\n      value: \"Suivant\"\n    })))))))), __jsx(Footer, null));\n  }\n};\n\nexport var __N_SSP = true;\nexport default Settings;","map":null,"metadata":{},"sourceType":"module"}