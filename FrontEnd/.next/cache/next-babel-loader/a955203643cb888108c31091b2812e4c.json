{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n// Dependencies ------------------------\nimport { useState, useEffect } from 'react';\nimport { Menu, Button, message } from 'antd';\nimport axios from 'axios';\nimport '../../../styles/ant-picker.scss';\nimport { storage } from '../firebase'; // Components -------------------------\n\nimport Head from '../head';\nimport Icon from '@ant-design/icons';\nimport HomeSvg from './Svg/HomeSvg';\nimport AboutSvg from './Svg/AboutSvg';\nimport CalendarSvg from './Svg/CalendarSvg';\nimport '../Sass/fullProfile.scss';\nimport LikeButton from '../LikeButton';\nimport Geocode from \"react-geocode\";\nimport Modal from 'antd/lib/modal/Modal';\nimport EditBox from './Components/EditBox';\nimport Calendar from './Components/BookMeeting';\nimport NavAcceuil from './Components/NavAcceuil';\nimport NavPropos from './Components/NavPropos';\nimport ProgressBar from './Components/ProgressBar';\nimport ProfileHead from './Components/ProfileHead'; // -------------------------------------\n\nfunction isEmpty(obj, type) {\n  if (type === \"Société\") {\n    for (var _i = 0, _Object$entries = Object.entries(obj); _i < _Object$entries.length; _i++) {\n      var _Object$entries$_i = _slicedToArray(_Object$entries[_i], 2),\n          key = _Object$entries$_i[0],\n          value = _Object$entries$_i[1];\n\n      if (value == \"\" || value == []) {\n        if (key !== \"booked\") {}\n      }\n    }\n  }\n\n  if (obj[\"addresse\"] === \"\") {\n    return true;\n  }\n\n  return false;\n} // ----------------------------\n\n\nvar ProfileBody = function ProfileBody(_ref) {\n  var profile = _ref.profile,\n      userid = _ref.userid;\n  // States ---------------------------------------\n  var name = profile.companyname === \"\" || profile.companyname == undefined ? profile.nom + \" \" + profile.prenom : profile.companyname;\n\n  var _useState = useState(false),\n      imageLoading = _useState[0],\n      setloadimage = _useState[1];\n\n  var _useState2 = useState('Acceuil'),\n      current = _useState2[0],\n      setCurrent = _useState2[1];\n\n  var _useState3 = useState(profile.stars.includes(userid)),\n      checkbox = _useState3[0],\n      setCheck = _useState3[1];\n\n  var _useState4 = useState(false),\n      bookmetting = _useState4[0],\n      setbook = _useState4[1];\n\n  var _useState5 = useState(profile),\n      data = _useState5[0],\n      setData = _useState5[1];\n\n  var _useState6 = useState({}),\n      location = _useState6[0],\n      setLocation = _useState6[1];\n\n  var _useState7 = useState(null),\n      filefirebase = _useState7[0],\n      setfire = _useState7[1];\n\n  var _useState8 = useState(0),\n      percentage = _useState8[0],\n      setPrecentage = _useState8[1];\n\n  var _useState9 = useState(false),\n      visible = _useState9[0],\n      setvisible = _useState9[1];\n\n  var _useState10 = useState(false),\n      loading = _useState10[0],\n      setloading = _useState10[1];\n\n  var _useState11 = useState(profile.diplome),\n      DiplomeList = _useState11[0],\n      setDiplomeList = _useState11[1];\n\n  var date = new Date(); // Icons -----------------------------------------\n\n  var HomeIcon = function HomeIcon(props) {\n    return __jsx(Icon, _extends({\n      component: HomeSvg\n    }, props));\n  };\n\n  var AboutIcon = function AboutIcon(props) {\n    return __jsx(Icon, _extends({\n      component: AboutSvg\n    }, props));\n  };\n\n  var CalendarIcon = function CalendarIcon(props) {\n    return __jsx(Icon, _extends({\n      component: CalendarSvg\n    }, props));\n  };\n\n  useEffect(function () {\n    var adr = profile.addresse + \" , \" + profile.city;\n    Geocode.setApiKey(\"AIzaSyChI3vJkg_P6JFZKVg9at3FtUZjxxI2lP8\");\n    Geocode.fromAddress(adr).then(function (response) {\n      var _response$results$0$g = response.results[0].geometry.location,\n          lat = _response$results$0$g.lat,\n          lng = _response$results$0$g.lng;\n      var loc = {\n        address: profile.addresse,\n        lat: lat,\n        lng: lng\n      };\n      setLocation(loc);\n    }, function (error) {\n      console.error(error);\n    });\n  }, []); // Firebase url upload function \n\n  var firebaseUrl = function firebaseUrl(file) {\n    return new Promise(function (resolve, reject) {\n      var currentImageName = \"firebase-image-\" + Date.now();\n      var uploadImage = storage.ref(\"images/\".concat(currentImageName)).put(file);\n      uploadImage.on('state_changed', function (snapshot) {\n        var per = Math.floor(snapshot.bytesTransferred / snapshot.totalBytes * 100);\n        setPrecentage(per);\n      }, function (error) {\n        reject(error);\n      }, function () {\n        storage.ref('images').child(currentImageName).getDownloadURL().then(function (url) {\n          var imageData = [url, currentImageName];\n          resolve(imageData);\n        });\n      });\n    });\n  }; // Handlers -------------------------------------\n\n\n  var handleLike = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var stars, Url;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              stars = profile.stars;\n\n              if (checkbox) {\n                _context.next = 6;\n                break;\n              }\n\n              _context.next = 4;\n              return stars.push(userid);\n\n            case 4:\n              _context.next = 8;\n              break;\n\n            case 6:\n              _context.next = 8;\n              return stars.splice(stars.indexOf(userid), 1);\n\n            case 8:\n              setCheck(!checkbox);\n              Url = 'http://15.237.56.214:9000/profiles/like?userid=' + profile._id;\n              axios.post(Url, {\n                \"stars\": stars\n              }, {\n                withCredentials: true\n              }).then(function (res) {\n                return console.log(res);\n              })[\"catch\"](function (err) {\n                return console.log(err);\n              });\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleLike() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleClick = function handleClick(e) {\n    setCurrent(e.key);\n  };\n\n  var handleBack = function handleBack() {\n    window.location.assign(\"/Search?companyname=\".concat(profile.companyname, \"&domaine=&city=&page=1\"));\n  };\n\n  var handleEdit = function handleEdit() {\n    setvisible(true);\n  };\n\n  var handleSave = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var OldData, imgData, url;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              OldData = data;\n              OldData[\"diplome\"] = DiplomeList;\n              setData(OldData);\n\n              if (!isEmpty(data, profile.type)) {\n                _context2.next = 7;\n                break;\n              }\n\n              message.error(\"Un ou plusieurs champs sont vides\");\n              _context2.next = 16;\n              break;\n\n            case 7:\n              setloading(true);\n\n              if (!(filefirebase !== null)) {\n                _context2.next = 14;\n                break;\n              }\n\n              setloadimage(true);\n              _context2.next = 12;\n              return firebaseUrl(filefirebase);\n\n            case 12:\n              imgData = _context2.sent;\n              setData(data.Usrimg = imgData[0]);\n\n            case 14:\n              url = \"http://15.237.56.214:9000/profiles/update?userid=\" + userid;\n              axios.post(url, data, {\n                withCredentials: true\n              }).then(function (response) {\n                if (response.status === 200) {\n                  setloading(false);\n                  setvisible(false);\n                  message.success(\"Mise à jour réussie\");\n                  setTimeout(function () {\n                    window.location.reload();\n                  }, 1000);\n                } else {\n                  message.error(\"Une erreur s'est produite, veuillez réessayer plus tard\");\n                }\n              })[\"catch\"](function (err) {\n                message.error(\"Une erreur s'est produite, veuillez réessayer plus tard\");\n                console.log(err);\n              });\n\n            case 16:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleSave() {\n      return _ref3.apply(this, arguments);\n    };\n  }(); // ----------------------- Returner ----------------------------------------\n\n\n  return __jsx(\"div\", {\n    className: \"Profile\"\n  }, __jsx(Head, {\n    title: name + \" | 6Solutions\"\n  }), __jsx(\"div\", {\n    className: \"ButtonContainer\",\n    onClick: handleBack\n  }, __jsx(\"i\", {\n    className: \"fa fa-arrow-left icon\"\n  }), __jsx(\"span\", {\n    className: \"backButton\"\n  }, \"Retour\")), __jsx(ProfileHead, {\n    profile: profile,\n    handleEdit: handleEdit,\n    setbook: setbook,\n    userid: userid\n  }), __jsx(\"div\", {\n    className: \"ProfileBody\"\n  }, __jsx(Modal, {\n    style: {\n      top: '9%'\n    },\n    title: \"Selectionnez la cellule correspondante a votre r\\xE9union\",\n    visible: bookmetting,\n    width: \"90%\",\n    bodyStyle: {\n      height: '70vh',\n      overflowY: 'scroll'\n    },\n    onCancel: function onCancel() {\n      return setbook(false);\n    },\n    footer: null\n  }, __jsx(Calendar, {\n    profile: profile,\n    loc: \"public\"\n  })), __jsx(Modal, {\n    title: \"Editez votre profile\",\n    className: \"EditModal\",\n    visible: visible,\n    bodyStyle: {\n      height: '50vh',\n      overflowY: 'scroll'\n    },\n    onCancel: function onCancel() {\n      return setvisible(false);\n    },\n    footer: [__jsx(Button, {\n      disabled: false,\n      key: \"submit\",\n      type: \"primary\",\n      loading: loading,\n      style: {\n        borderRadius: '10px',\n        fontFamily: 'GlacialBold'\n      },\n      onClick: handleSave\n    }, \"Termin\\xE9 !\")]\n  }, !imageLoading && __jsx(EditBox, {\n    data: data,\n    setData: setData,\n    setDiplomeList: setDiplomeList,\n    DiplomeList: DiplomeList,\n    setfire: setfire\n  }), imageLoading && __jsx(ProgressBar, {\n    percentage: percentage\n  })), __jsx(Menu, {\n    onClick: handleClick,\n    selectedKeys: current,\n    mode: \"horizontal\",\n    style: {\n      marginTop: '3%'\n    }\n  }, __jsx(Menu.Item, {\n    key: \"Acceuil\",\n    icon: __jsx(HomeIcon, null)\n  }, \"Acceuil\"), __jsx(Menu.Item, {\n    key: \"propos\",\n    icon: __jsx(AboutIcon, null)\n  }, \"A propos\"), userid === profile._id && profile.type === \"Société\" && __jsx(Menu.Item, {\n    key: \"Calendar\",\n    icon: __jsx(CalendarIcon, null)\n  }, \"Calendrier\")), __jsx(\"div\", {\n    className: \"MenuContent\"\n  }, current === \"Acceuil\" && __jsx(React.Fragment, null, __jsx(NavAcceuil, {\n    date: date,\n    profile: profile\n  })), current === \"propos\" && __jsx(React.Fragment, null, __jsx(NavPropos, {\n    profile: profile,\n    location: location\n  })), current === \"Calendar\" && __jsx(\"div\", {\n    style: {\n      marginTop: '30px'\n    }\n  }, __jsx(Calendar, {\n    profile: profile,\n    loc: \"profile\"\n  }))), __jsx(\"div\", {\n    className: \"MenuFooter\"\n  }, userid !== profile._id && profile.type === \"Société\" && __jsx(\"div\", {\n    className: \"like\"\n  }, __jsx(LikeButton, {\n    checkbox: checkbox,\n    handleLike: handleLike\n  }), __jsx(\"label\", {\n    htmlFor: \"checkbox\",\n    className: checkbox ? \"active\" : \"\"\n  }, \"J'aime\")), __jsx(\"div\", {\n    className: \"share\"\n  }, __jsx(\"i\", {\n    className: \"fa fa-share-alt\",\n    \"aria-hidden\": \"true\",\n    style: {\n      marginRight: '5px'\n    }\n  }), \"Partager\"))));\n};\n\nexport default ProfileBody;","map":null,"metadata":{},"sourceType":"module"}